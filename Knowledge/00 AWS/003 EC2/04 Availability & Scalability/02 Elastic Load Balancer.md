# Definition
---
Elastic Balancer is a load balancer that fully managed by AWS. AWS guarantee it **should be work** and also in charge of its **upgrades, maintenance and high availability**

# Benefits
---
* Only a few configuration knobs
* Less Effort
* Integration with many AWS Services / Offerings
	* E.g. [[01 Introduction|EC2]], EC2 **Auto Scaling Groups**, Amazon **ECS**, AWS Certificate Manager (**ACM**), CloudWatch, Route 53, AWS **WAF**, AWS **Global Accelerator**

# Generation & Version
---

* v1: Classic Load Balancer (**Deprecated**) - 2009
	* Works On: HTTP, HTTPS, TLS, SSL
* v2: [[02-1 Application Load Balancer|Application Load Balancer]]
	* Works On: HTTP, HTTPS, WebSocket
* v2: [[02-2 Network Load Balancer|Network Load Balancer (NLB)]]
	* Works On: TCP, TLS, UDP
* v3: [[02-3 Gateway Load Balancer (GWLB)|Gateway Load Balancer (GWLB)]]
	* Works On: IP (Network Layer)

# Features
---

## Sticky Sessions
---

### Definitions
---
It is possible to implement stickiness so that the **same client is always redirected to the same instance** behind a load balancer. It could be used for **Classic Load Balancer (CLB), Application Load Balancer (ALB) and Network Load Balancer (NLB)**.

![[Pasted image 20230718232431.png]]

### Working Machanism: Cookies
---

CLB and ALB uses **cookies with an controlled expiration date** to 'stick' client. The category of cookies include:
* **Application-Based** Cookies
	* Custom Cookie
		* Generated By **Target** & Can **add any custom attributes** that target needs
		* Cookie name should be **unique** for each target group
	* Application Cookie
		* Generated By **Load Balancer**, named **AWSALBAPP**
* **Duration-Based** Cookies: Generated by **Load Balancer**, named **AWSALB** for Application Load Balancer and **AWSELB** for Classic Load Balancer

### Pros & Cons
---
* Pros: Could **keep users' session data** and make sure they can assess to the same instance
* Cons: May cause the **imbalance** of load to the backend AWS instances

## Cross-Zone Load Balancing
---

### Definitions
---

Each Load Balancer distributes evenly across all registered instances **on all Availability Zones** (AZs)

![[cross_zone_load_balancing.png]]

### Default Settings & Charges
---

* Application Load Balancer
	* **Enabled** By Default & Can be closed at target group level
	* **No charge** for inter AZ data
* Network Load Balancer & Gateway Load Balancer
	* **Disabled** By Default
	* **Pay Charges** for inter AZ data
* Classic Load Balancer
	* **Disabled** By Default
	* **No Charges** for inter AZ data

## SSL Certificates
---

### Definition 
---

**SSL** (Secure Socket Layer) along with **TLS** (Transport Layer Security) is always used to **encrypt the connection**.
* It's usually issued by **Certificate Authorities (CA)** -> E.g. GoDaddy, Symantec, Digicert
* It has an **expiration date** and need to be renewed

### Use in AWS
---

![[ssl_certificate.png]]
An SSL Certificate allows traffic between your **clients** and your **load balancer** **to be encrypted in transit** (in-flight encryption)
* This certificate should be **X.509 certificate** (or SSL/TLS Server Certificate), which could be the one managed by **ACM** (AWS Certificate Manager) or the one **uploaded by user**

HTTPS listener: 
* Must specify a **default certificate** 
* Can add **an optional list of certs** to support multiple domains. In this case, clients can use [[#Concept Server Name Indication (SNI)|Server Name Indication (SNI)]] to specify the hostname they reach 
* Can **specify a security policy** to support older versions of SSL / TLS (legacy clients)

### Support
---
* Network Load Balancer (**NLB**) and Application Load Balancer (**ALB**) can support multiple listeners with multiple certificates, it uses [[#Concept Server Name Indication (SNI)|Server Name Indication (SNI)]] to make it work
* Classic Load Balancer (**CLB**) can only have one certificate, therefore it need multiple CLBs for multiple hostnames to have multiple certificates

### Concept: Server Name Indication (SNI)
---

It's a 'newer' protocol that requires clients to indicate the **hostname of target server** in the initial SSL handshake, so that server will find the correct certificate and return default one.
* Solve the problem of **loading multiple SSL certificates in one server**

![[SNI.png]]

## Connection Draining / De-registered delay
---
* Definition: Time to **complete “in-flight requests”** while the instance is **de-registering or unhealthy** (During this time the draining instance will stop sending new requests)
	* Range: **0-3600 seconds** (could be disabled by setting the value to 0)
	* Set a smaller value for short request and a higher valuer for long-live request
![[connection_draining.png]]

# Security: Security Group
---
![[Load Balancer Security Group.png]]